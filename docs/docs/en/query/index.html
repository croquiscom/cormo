<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Query · CORMO</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="To query, create a query object using [[#BaseModel.query]] first."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Query · CORMO"/><meta property="og:type" content="website"/><meta property="og:url" content="https://croquiscom.github.io/cormo/"/><meta property="og:description" content="To query, create a query object using [[#BaseModel.query]] first."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/cormo/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/cormo/js/scrollSpy.js"></script><link rel="stylesheet" href="/cormo/css/main.css"/><script src="/cormo/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/cormo/en"><h2 class="headerTitle">CORMO</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/cormo/docs/en/getting-started" target="_self">Docs</a></li><li class=""><a href="/cormo/api/cormo" target="_self">API</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/cormo/img/language.svg" alt="Languages icon"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/cormo/docs/ko/query">한국어</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Getting Started</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/cormo/docs/en/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/cormo/docs/en/define-models">Define Models</a></li><li class="navListItem"><a class="navItem" href="/cormo/docs/en/create-records">Create Records</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/cormo/docs/en/query">Query</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced</h3><ul class=""><li class="navListItem"><a class="navItem" href="/cormo/docs/en/aggregation">Aggregation</a></li><li class="navListItem"><a class="navItem" href="/cormo/docs/en/association">Association</a></li><li class="navListItem"><a class="navItem" href="/cormo/docs/en/callback">Callback</a></li><li class="navListItem"><a class="navItem" href="/cormo/docs/en/constraint">Constraint</a></li><li class="navListItem"><a class="navItem" href="/cormo/docs/en/geospatial">Geospatial</a></li><li class="navListItem"><a class="navItem" href="/cormo/docs/en/miscellaneous">Miscellaneous</a></li><li class="navListItem"><a class="navItem" href="/cormo/docs/en/validation">Validation</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Query</h1></header><article><div><span><p>To query, create a query object using [[#BaseModel.query]] first.
Then build up a query by chaining methods,
and run a query by [[#Query::exec]], [[#Query::count]], [[#Query::update]], or [[#Query::delete]].</p>
<p>Also, [[#BaseModel]] class has some methods that borrowed from [[#Query]] to run simple queries easily.</p>
<pre><code class="hljs css language-coffeescript">User.query().where(age: <span class="hljs-number">27</span>).exec (error, users) -&gt;
  <span class="hljs-built_in">console</span>.log users

User.where(age: <span class="hljs-number">27</span>).exec (error, users) -&gt;
  <span class="hljs-built_in">console</span>.log users

User.where age:<span class="hljs-number">27</span>, <span class="hljs-function"><span class="hljs-params">(error, users)</span> -&gt;</span>
  <span class="hljs-built_in">console</span>.log users
</code></pre>
<pre><code class="hljs css language-javascript">User.query().where({<span class="hljs-attr">age</span>: <span class="hljs-number">27</span>}).exec(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, users</span>) </span>{
  <span class="hljs-built_in">console</span>.log(users);
});

User.where({<span class="hljs-attr">age</span>: <span class="hljs-number">27</span>}).exec(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, users</span>) </span>{
  <span class="hljs-built_in">console</span>.log(users);
});

User.where({<span class="hljs-attr">age</span>:<span class="hljs-number">27</span>}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, users</span>) </span>{
  <span class="hljs-built_in">console</span>.log(users);
});
</code></pre>
<h1><a class="anchor" aria-hidden="true" id="selection-criteria"></a><a href="#selection-criteria" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Selection criteria</h1>
<p>You can give criteria for selection with [[#Query::where]] or [[#Query::find]].
[[#Query::where]]'s criteria is similar to the MongoDB's.
Two or more [[#Query::where]]s mean a logical and.</p>
<table class='table table-bordered'><thead><tr>
  <th>Description</th><th>CORMO</th><th>SQL</th><th>MongoDB</th>
</tr></thead><tbody>
<tr>
<td>Equal</td>
<td>User.where(age: 27).exec (error, users) -></td>
<td>SELECT * FROM users WHERE age=27</td>
<td>db.users.find({age: 27})</td>
</tr>
<tr>
<td rowspan='4'>Logical and</td>
<td>name: 'John Doe', age: 27</td>
<td rowspan='4'>name='John Doe' AND age=27</td>
<td rowspan='4'>{ name: 'John Doe', age: 27 }</td>
</tr>
<tr>
<td>.where(name: 'John Doe').where(age: 27)</td>
</tr>
<tr>
<td>$and: [ { name: 'John Doe' }, { age: 27 } ]</td>
</tr>
<tr>
<td>[ { name: 'John Doe' }, { age: 27 } ]</td>
</tr>
<tr>
<td>Logical or</td>
<td>$or: [ { name: 'John Doe' }, { age: 27 } ]</td>
<td>name='John Doe' OR age=27</td>
<td>{ $or: [ { name: 'John Doe' }, { age: 27 } ] }</td>
</tr>
<tr>
<td>Comparison ($lt, $gt, $lte, $gte)</td>
<td>[ { age: { $gt: 30 } }, { age: { $lte: 45 } } ]</td>
<td>age>30 AND age<=45</td>
<td>{ $and: [ { age: { $gt: 30 } }, { age: { $lte: 45 } } ] }</td>
</tr>
<tr>
<td rowspan='2'>Containing some text in case insensitive</td>
<td>name: { $contains: 'smi' }</td>
<td>name LIKE '%smi%'</td>
<td>{ name: /smi/i }</td>
</tr>
<tr>
<td>name: { $contains: ['smi', 'doe'] }</td>
<td>name LIKE '%smi%' OR name LIKE '%doe%'</td>
<td>{ name: { $in: [/smi/i, /doe/i] } }</td>
</tr>
<tr>
<td>Starts with some text in case insensitive</td>
<td>name: { $startswith: 'smi' }</td>
<td>name LIKE 'smi%'</td>
<td>{ name: /^smi/i }</td>
</tr>
<tr>
<td>Ends with some text in case insensitive</td>
<td>name: { $endswith: 'smi' }</td>
<td>name LIKE '%smi'</td>
<td>{ name: /smi$/i }</td>
</tr>
<tr>
<td rowspan='2'>Regular expression</td>
<td>name: /smi/</td>
<td>name REGEXP 'smi'</td>
<td>{ name: /smi/i }</td>
</tr>
<tr>
<td>name: /smi|doe/</td>
<td>name REGEXP 'smi|doe'</td>
<td>{ name: /smi|doe/i }</td>
</tr>
<tr>
<td rowspan='2'>Matches any of an array</td>
<td>age: { $in: [ 10, 20, 30 ] }</td>
<td rowspan='2'>age IN (10,20,30)</td>
<td rowspan='2'>{ age: { $in: [ 10, 20, 30 ] } }</td>
</tr>
<tr>
<td>age: [ 10, 20, 30 ]</td>
</tr>
<tr>
<td rowspan='7'>Logical not</td>
<td>age: $not: 27</td>
<td>NOT (age=27) OR age IS NULL</td>
<td>{ age: { $ne: 27 } }</td>
</tr>
<tr>
<td>age: $not: $lt: 27</td>
<td>NOT (age<27) OR age IS NULL</td>
<td>{ age: { $not: { $lt: 27 } } }</td>
</tr>
<tr>
<td>name: $not: $contains: 'smi'</td>
<td>NOT (name LIKE '%smi%') OR name IS NULL</td>
<td>{ name: { $not: /smi/i } }</td>
</tr>
<tr>
<td>name: $not: $contains: ['smi', 'doe']</td>
<td>NOT (name LIKE '%smi%' OR name LIKE '%doe%') OR name IS NULL</td>
<td>{ name: { $nin: [/smi/i, /doe/i] } }</td>
</tr>
<tr>
<td>age: $not: $in: [ 10, 20, 30 ]</td>
<td rowspan='2'>NOT (age IN (10,20,30)) OR age IS NULL</td>
<td rowspan='2'>{ age: { $nin: [10,20,30] } }</td>
</tr>
<tr>
<td>age: $not: [ 10, 20, 30 ]</td>
</tr>
<tr>
<td>name: $not: null</td>
<td>NOT name IS NULL</td>
<td>{ age: { $ne: null } }</td>
</tr>
</tbody></table>
<p>If you want find records based on the identifier, use [[#Query::find]] that accepts an ID or an array of IDs.
It is logically same to '.where(id: &lt;given ID or array of IDs&gt;)'.</p>
<h2><a class="anchor" aria-hidden="true" id="conditional-criteria"></a><a href="#conditional-criteria" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conditional criteria</h2>
<p>If you want to apply different criteria in one query chain, you can use [[#Query::if]], [[#Query::endif]].
It is helpful such as when you corresspond one REST API to one query.</p>
<pre><code class="hljs css language-coffeescript"><span class="hljs-function"><span class="hljs-title">getUsers</span> = <span class="hljs-params">(options)</span> -&gt;</span>
  User.query()
  .where(age: $gt: <span class="hljs-number">30</span>)
  .<span class="hljs-keyword">if</span>(options.limit).limit(options.limit).endif()
  .<span class="hljs-keyword">if</span>(options.fields).select(options.fields).endif()
  .exec()
</code></pre>
<pre><code class="hljs css language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUsers</span>(<span class="hljs-params">options</span>) </span>{
  <span class="hljs-keyword">return</span> User.query()
  .where({<span class="hljs-attr">age</span>: {<span class="hljs-attr">$gt</span>: <span class="hljs-number">30</span>}})
  [<span class="hljs-string">"if"</span>](options.limit).limit(options.limit).endif()
  [<span class="hljs-string">"if"</span>](options.fields).select(options.fields).endif()
  .exec();
};
</code></pre>
<h1><a class="anchor" aria-hidden="true" id="retrieve-records"></a><a href="#retrieve-records" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Retrieve records</h1>
<p>[[#Query::exec]] retrieves records.</p>
<p>It normally returns an array of Model instances.
But if you use [[#Query::find]] for a single ID, it will return a single Model instance.</p>
<pre><code class="hljs css language-coffeescript">User.find <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-params">(error, user)</span> -&gt;</span>
  <span class="hljs-built_in">console</span>.log user

User.find [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], <span class="hljs-function"><span class="hljs-params">(error, users)</span> -&gt;</span>
  <span class="hljs-built_in">console</span>.log users
</code></pre>
<pre><code class="hljs css language-javascript">User.find(<span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, user</span>) </span>{
  <span class="hljs-built_in">console</span>.log(user);
});

User.find([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, users</span>) </span>{
  <span class="hljs-built_in">console</span>.log(users);
});
</code></pre>
<p>[[#Query::find]] does not return error if any ID is found and does not preserve given order.
If you want to guarantee that you get all records of IDs and order is preserved,
use [[#Query::findPreserve]] instead.</p>
<pre><code class="hljs css language-coffeescript">User.findPreserve [<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], <span class="hljs-function"><span class="hljs-params">(error, users)</span> -&gt;</span>
  <span class="hljs-comment"># users[0].id is 2 and users[1].id is 1 and users[2].id is 2 and users[3].id is 3</span>
</code></pre>
<pre><code class="hljs css language-javascript">User.findPreserve([<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, users</span>) </span>{
  <span class="hljs-comment">// users[0].id is 2 and users[1].id is 1 and users[2].id is 2 and users[3].id is 3</span>
});
</code></pre>
<p>You can give some options to [[#Query::exec]].</p>
<table class='table table-bordered'><thead><tr>
  <th>Description</th><th>CORMO</th><th>SQL</th><th>MongoDB</th>
</tr></thead><tbody>
<tr>
<td>Projection</td>
<td>User.select('name age').exec</td>
<td>SELECT id,name,age FROM users</td>
<td>db.users.find({}, { name: 1, age: 1 })</td>
</tr>
<tr>
<td>Sort</td>
<td>User.order('age -name').exec</td>
<td>SELECT \* FROM users ORDER BY age ASC, name DESC</td>
<td>db.users.find().sort({ age: 1, name: -1 })</td>
</tr>
<tr>
<td>Limit</td>
<td>User.query().limit(3).exec</td>
<td>SELECT \* FROM users LIMIT 3</td>
<td>db.users.find().limit(3)</td>
</tr>
<tr>
<td>Skip</td>
<td>User.query().skip(3).exec</td>
<td>SELECT * FROM users LIMIT 2147483647 OFFSET 3</td>
<td>db.users.find().skip(3)</td>
</tr>
</tbody></table>
<h2><a class="anchor" aria-hidden="true" id="request-only-one-record"></a><a href="#request-only-one-record" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request only one record</h2>
<p>If you know that there will be only one result (e.x. query on unique column), [[#Query::one]] will be helpful.
It makes a query return a single instance (or null) instead of array of instances.</p>
<pre><code class="hljs css language-coffeescript">User.where(age: <span class="hljs-number">27</span>).one().exec (error, user) -&gt;
  <span class="hljs-built_in">console</span>.log user
</code></pre>
<pre><code class="hljs css language-javascript">User.where({<span class="hljs-attr">age</span>: <span class="hljs-number">27</span>}).one().exec(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, user</span>) </span>{
  <span class="hljs-built_in">console</span>.log(user);
});
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="stream-the-result"></a><a href="#stream-the-result" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stream the result</h2>
<p>If the result has many records, you can use Node.js stream API to reduce memory usage.</p>
<pre><code class="hljs css language-coffeescript">count = <span class="hljs-number">0</span>
User.where(age: <span class="hljs-number">27</span>).stream()
.<span class="hljs-literal">on</span> <span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-params">(user)</span> -&gt;</span>
  count++
.<span class="hljs-literal">on</span> <span class="hljs-string">'end'</span>, <span class="hljs-function">-&gt;</span>
</code></pre>
<pre><code class="hljs css language-javascript">count = <span class="hljs-number">0</span>;
User.where({<span class="hljs-attr">age</span>: <span class="hljs-number">27</span>}).stream()
.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">user</span>) </span>{
  count++;
}).on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
});
</code></pre>
<h1><a class="anchor" aria-hidden="true" id="count-records"></a><a href="#count-records" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Count records</h1>
<p>[[#Query::count]] returns the count of records.</p>
<table class='table table-bordered'><thead><tr>
  <th>CORMO</th><th>SQL</th><th>MongoDB</th>
</tr></thead><tbody>
<tr>
<td>User.count (error, count) -></td>
<td>SELECT COUNT(\*) FROM users</td>
<td>db.users.count()</td>
</tr>
<tr>
<td>User.count age: 27, (error, count) -></td>
<td rowspan='2'>SELECT COUNT(\*) FROM users WHERE age=27</td>
<td rowspan='2'>db.users.find({age: 27}).count()</td>
</tr>
<tr>
<td>User.where(age: 27).count (error, count) -></td>
</tr>
</tbody></table>
<h1><a class="anchor" aria-hidden="true" id="update-records"></a><a href="#update-records" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Update records</h1>
<p>To update records, [[#BaseModel::save]] and [[#Query::update]] are provided.</p>
<p>[[#BaseModel::save]] is used to update a single retrieved record.</p>
<pre><code class="hljs css language-coffeescript">User.find <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-params">(error, user)</span> -&gt;</span>
  user.age = <span class="hljs-number">30</span>
  user.save (error) -&gt;
</code></pre>
<pre><code class="hljs css language-javascript">User.find(<span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, user</span>) </span>{
  user.age = <span class="hljs-number">30</span>;
  user.save(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>{
  });
});
</code></pre>
<p>But [[#BaseModel::save]] has some weaknesses.</p>
<ul>
<li>You must retrieve a record before modification.
<ul>
<li>In normal application, retrieved data may not be used usually.</li>
</ul></li>
<li>This requires to read all fields from database and send all fields to database.
<ul>
<li>If you save projected([[#Query::select]]) record, other fields will set to null.</li>
<li>CORMO has the partial update option([[#BaseModel.dirty_tracking]]). But currently it rather is slow. So it is turned off by default.</li>
</ul></li>
</ul>
<p>[[#Query::update]] updates selected records.</p>
<table class='table table-bordered'><thead><tr>
  <th>CORMO</th><th>SQL</th><th>MongoDB</th>
</tr></thead><tbody>
<tr>
<td>User.update { age: 10 }, age: 27, (error, count) -></td>
<td rowspan='2'>UPDATE users SET age=10 WHERE age=27</td>
<td rowspan='2'>db.users.update({age: 27}, {$set: {age: 10}}, {multi: true})</td>
</tr>
<tr>
<td>User.where(age: 27).update age:10, (error, count) -></td>
</tr>
<tr>
<td>User.find(1).update age: 10, (error, count) -></td>
<td>UPDATE users SET age=10 WHERE id=1</td>
<td>db.users.update({_id: 1}, {$set: {age: 10}}, {multi: true})</td>
</tr>
<tr>
<td>User.find(2).update age: $inc: 3, (error, count) -></td>
<td>UPDATE users SET age=age+3 WHERE id=2</td>
<td>db.users.update({_id: 2}, {$inc: {age: 3}}, {multi: true})</td>
</tr>
</tbody></table>
<p>But you cannot use other column's value as data like SQL does on [[#Query::update]].
If you want this, you must retrieve the record first.
But [[#Query::update]] may be more efficient than [[#BaseModel::save]] even if in that case.</p>
<pre><code class="hljs css language-coffeescript">User.find <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-params">(error, user)</span> -&gt;</span>
  age = user.age + <span class="hljs-number">1</span>
  User.find(user.id).update age: age, <span class="hljs-function"><span class="hljs-params">(error, count)</span> -&gt;</span>
</code></pre>
<pre><code class="hljs css language-javascript">User.find(<span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, user</span>) </span>{
  <span class="hljs-keyword">var</span> age = user.age + <span class="hljs-number">1</span>;
  User.find(user.id).update({<span class="hljs-attr">age</span>: age}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, count</span>) </span>{
  });
});
</code></pre>
<h1><a class="anchor" aria-hidden="true" id="delete-records"></a><a href="#delete-records" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Delete records</h1>
<p>[[#Query::delete]] or [[#BaseModel::destroy]] deletes some records.
[[#BaseModel::destroy]] is similar to [[#Query::delete]] on the model's ID.</p>
<table class='table table-bordered'><thead><tr>
  <th>CORMO</th><th>SQL</th><th>MongoDB</th>
</tr></thead><tbody>
<tr>
<td>User.delete age: 27, (error, count) -></td>
<td rowspan='2'>DELETE FROM users WHERE age=27</td>
<td rowspan='2'>db.users.remove({age: 27})</td>
</tr>
<tr>
<td>User.where(age: 27).delete (error, count) -></td>
</tr>
<tr>
<td>User.delete (error, count) -></td>
<td>DELETE FROM users</td>
<td>db.users.remove()</td>
</tr>
</tbody></table>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/cormo/docs/en/create-records"><span class="arrow-prev">← </span><span>Create Records</span></a><a class="docs-next button" href="/cormo/docs/en/aggregation"><span>Aggregation</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#conditional-criteria">Conditional criteria</a></li><li><a href="#request-only-one-record">Request only one record</a></li><li><a href="#stream-the-result">Stream the result</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2012-2020 Croquis inc.</section></footer></div></body></html>