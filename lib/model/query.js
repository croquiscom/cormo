// Generated by CoffeeScript 1.9.3
(function() {
  var ModelQuery, Query, bindDomain;

  bindDomain = require('../util').bindDomain;

  Query = require('../query');

  ModelQuery = (function() {
    function ModelQuery() {}

    ModelQuery._createQueryAndRun = function(criteria, data, callback) {
      var query;
      query = new Query(this);
      query[criteria](data);
      if (typeof callback === 'function') {
        query.exec(callback);
      }
      return query;
    };

    ModelQuery._createOptionalQueryAndRun = function(criteria, data, callback) {
      if (typeof data === 'function') {
        return this._createQueryAndRun(criteria, null, data);
      } else {
        return this._createQueryAndRun(criteria, data, callback);
      }
    };

    ModelQuery.query = function() {
      return new Query(this);
    };

    ModelQuery.find = function(id, callback) {
      return this._createQueryAndRun('find', id, callback);
    };

    ModelQuery.findPreserve = function(ids, callback) {
      return this._createQueryAndRun('findPreserve', ids, callback);
    };

    ModelQuery.where = function(condition, callback) {
      return this._createOptionalQueryAndRun('where', condition, callback);
    };

    ModelQuery.select = function(columns, callback) {
      return this._createOptionalQueryAndRun('select', columns, callback);
    };

    ModelQuery.order = function(orders, callback) {
      return this._createOptionalQueryAndRun('order', orders, callback);
    };

    ModelQuery.group = function(group_by, fields, callback) {
      var query;
      query = new Query(this);
      query.group(group_by, fields);
      if (typeof callback === 'function') {
        query.exec(callback);
      }
      return query;
    };

    ModelQuery.count = function(condition, callback) {
      if (typeof condition === 'function') {
        callback = condition;
        condition = null;
      }
      return new Query(this).where(condition).count().nodeify(bindDomain(callback));
    };

    ModelQuery.update = function(updates, condition, callback) {
      if (typeof condition === 'function') {
        callback = condition;
        condition = null;
      }
      return new Query(this).where(condition).update(updates).nodeify(bindDomain(callback));
    };

    ModelQuery["delete"] = function(condition, callback) {
      if (typeof condition === 'function') {
        callback = condition;
        condition = null;
      }
      return new Query(this).where(condition)["delete"]().nodeify(bindDomain(callback));
    };

    return ModelQuery;

  })();

  module.exports = ModelQuery;

}).call(this);
