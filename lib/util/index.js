// Generated by CoffeeScript 2.3.1
//#
// Utilities
// @module util
// @namespace cormo
var Promise;

Promise = require('bluebird');

//#
// Returns leaf object and last part.

// e.g.) (obj, 'a.b.c') -> [ obj.a.b, 'c' ]
// @memberOf util
// @param {Object} obj
// @param {String|Array<String>} path
// @param {Boolean} [create_object=true]
// @return {Array} [ leaf_object, last_part_of_path ]
exports.getLeafOfPath = function(obj, path, create_object) {
  var i, j, last, len, len1, part, parts;
  parts = Array.isArray(path) ? path.slice(0) : path.split('.');
  last = parts.pop();
  if (parts.length > 0) {
    if (create_object !== false) {
      for (i = 0, len = parts.length; i < len; i++) {
        part = parts[i];
        obj = obj[part] || (obj[part] = {});
      }
    } else {
      for (j = 0, len1 = parts.length; j < len1; j++) {
        part = parts[j];
        obj = obj[part];
        if (!obj) {
          return [];
        }
      }
    }
  }
  return [obj, last];
};

//#
// Gets a value of object by path
// @memberOf util
// @param {Object} obj
// @param {String|Array<String>} path
// @return {*}
exports.getPropertyOfPath = function(obj, path) {
  var last;
  [obj, last] = exports.getLeafOfPath(obj, path, false);
  return obj != null ? obj[last] : void 0;
};

//#
// Sets a value to object by path
// @memberOf util
// @param {Object} obj
// @param {String|Array<String>} path
// @param {*} value
exports.setPropertyOfPath = function(obj, path, value) {
  var last;
  [obj, last] = exports.getLeafOfPath(obj, path);
  obj[last] = value;
};

//#
// Sures a function call in the original domain
// @memberOf util
// @param {Function} fn
// @return {Function}
exports.bindDomain = function(fn) {
  var d;
  if (fn && (d = process.domain)) {
    return d.bind(fn);
  } else {
    return fn;
  }
};
